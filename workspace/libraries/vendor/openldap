#!/usr/bin/env bash
# Build Path: /app/.heroku/python/
# Build Deps: libraries/vendor/berkleydb libraries/vendor/groff

OUT_PREFIX=$1

echo "-----> Building openldap"

curl -O http://www.openldap.org/software/download/OpenLDAP/openldap-release/openldap-2.4.44.tgz
tar -xvf openldap-2.4.44.tgz
pushd openldap-2.4.44
CPPFLAGS="-I$OUT_PREFIX/.python-ldap/berkleydb/include ${CPPFLAGS}"; \
  LDFLAGS="-L$OUT_PREFIX/.python-ldap/berkleydb/lib ${LDFLAGS}"; \
  ./configure --enable-bdb --enable-crypt --with-tls=openssl --prefix=$OUT_PREFIX/openldap
make depend
make -s -j 9
make install -s
popd
