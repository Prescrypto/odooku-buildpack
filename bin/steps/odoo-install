#!/usr/bin/env bash

ARCHIVE_ODOO="https://github.com/odoo/odoo/archive/9.0.tar.gz"
ARCHIVE_COMPAT="https://github.com/adaptivdesign/odooku-compat/archive/master.tar.gz"

mkdir ./odoo_tmp ./compat_tmp
curl -sL $ARCHIVE_ODOO | tar xz -C ./odoo_tmp --strip 1
curl -sL $ARCHIVE_COMPAT | tar xz -C ./compat_tmp --strip 1
cp -a ./compat_tmp/patch/. ./odoo_tmp/
pip install --upgrade --no-dependencies --no-cache-dir ./odoo_tmp
mv ./odoo_tmp/addons .heroku/odoo/addons
rm -r ./odoo_tmp ./compat_tmp

# Copy wrapper script
cp $ROOT_DIR/lib/odooku .heroku/odoo/bin

export ODOOKU_ADDONS="$HOME/.heroku/odoo/lib/python2.7/site-packages/openerp/addons,$HOME/.heroku/odoo/addons"
if [ -d "./addons" ]; then
  export ODOOKU_ADDONS="$ODOOKU_ADDONS,$HOME/addons"
fi
